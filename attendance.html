<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mark Attendance | OM Enterprise</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial;
  background:#f4f6f8;
  padding:30px;
}
.container{
  max-width:420px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
h2{text-align:center;color:#1e88e5;margin-bottom:20px;}
select,input,button{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  font-size:14px;
}
.time-box{
  display:flex;
  gap:6px;
}
button{
  border:none;
  border-radius:6px;
  background:#1e88e5;
  color:#fff;
  cursor:pointer;
}
button.out{background:#e53935;}
small{color:#555;}
</style>
</head>

<body>

<div class="container">
  <h2>Mark Attendance</h2>

  <select id="empSelect">
    <option value="">Select Employee</option>
    <option value="101|Ishwarbhai Patel">101 - Ishwarbhai Patel</option>
    <option value="102|Hetvi Patel">102 - Hetvi Patel</option>
    <option value="103|Suresh Patel">103 - Suresh Patel</option>
    <option value="104|Shailesh Panchal">104 - Shailesh Panchal</option>
    <option value="105|Nitin Panchal">105 - Nitin Panchal</option>
  </select>

  <small>IN Time (Manual)</small>
  <div class="time-box">
    <input type="number" id="inHour" min="1" max="12" placeholder="HH">
    <input type="number" id="inMin" min="0" max="59" placeholder="MM">
    <select id="inMer">
      <option>AM</option>
      <option>PM</option>
    </select>
  </div>

  <small>OUT Time (Manual)</small>
  <div class="time-box">
    <input type="number" id="outHour" min="1" max="12" placeholder="HH">
    <input type="number" id="outMin" min="0" max="59" placeholder="MM">
    <select id="outMer">
      <option>AM</option>
      <option>PM</option>
    </select>
  </div>

  <button onclick="markIn()">Enter Time (IN)</button>
  <button class="out" onclick="markOut()">Exit Time (OUT)</button>
</div>

<script>
// ===== DATE =====
function today(){
  const d=new Date();
  return `${String(d.getDate()).padStart(2,'0')}-${String(d.getMonth()+1).padStart(2,'0')}-${d.getFullYear()}`;
}

// ===== AM/PM â†’ 24H =====
function getTime(h,m,mer){
  if(!h) return null;
  h=parseInt(h); m=parseInt(m||0);
  if(mer==="PM" && h!==12) h+=12;
  if(mer==="AM" && h===12) h=0;
  return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:00`;
}

// ===== HOURS CALC =====
function calcHours(inT,outT){
  const i=new Date(`1970-01-01 ${inT}`);
  const o=new Date(`1970-01-01 ${outT}`);
  let diff=(o-i)/1000/60/60;
  if(diff<0) diff=0;
  return diff.toFixed(2);
}

// ===== MARK IN =====
function markIn(){
  const val=document.getElementById("empSelect").value;
  if(!val){alert("Select employee");return;}

  const inTime=getTime(
    inHour.value,inMin.value,inMer.value
  );
  if(!inTime){alert("Enter IN time");return;}

  let data=JSON.parse(localStorage.getItem("attendance"))||[];
  const [id,name]=val.split("|");

  if(data.find(r=>r.id===id && r.date===today())){
    alert("IN already marked"); return;
  }

  data.push({
    id,name,
    date:today(),
    inTime,
    outTime:"-",
    workHours:"-"
  });

  localStorage.setItem("attendance",JSON.stringify(data));
  alert("IN time saved");
}

// ===== MARK OUT =====
function markOut(){
  const val=document.getElementById("empSelect").value;
  if(!val){alert("Select employee");return;}

  const outTime=getTime(
    outHour.value,outMin.value,outMer.value
  );
  if(!outTime){alert("Enter OUT time");return;}

  let data=JSON.parse(localStorage.getItem("attendance"))||[];
  const [id]=val.split("|");
  const rec=data.find(r=>r.id===id && r.date===today());

  if(!rec){alert("IN not found");return;}
  if(rec.outTime!=="-"){alert("OUT already marked");return;}

  rec.outTime=outTime;
  rec.workHours=calcHours(rec.inTime,outTime)+" hrs";

  localStorage.setItem("attendance",JSON.stringify(data));
  alert("OUT time saved");
}
</script>

</body>
</html>
